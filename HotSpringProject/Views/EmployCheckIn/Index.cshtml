
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="wrapper wrapper-content">
    <div class="row">
        <div class="col-sm-4">
            <div style="background-color:yellow;border-radius:30px;padding:20px">
                <h3 style="color:black">
                    &nbsp;&nbsp;&nbsp;您好,尊敬的 @ViewBag.name 先生
                    <br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;欢迎使用本OA自动化办公系统,期待您有一个良好的体验
                </h3>
            </div>
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5 style="font-weight:bold">勤劳签到卡</h5>
                </div>
                <div class="ibox-content">
                    <p style="font-weight:bold">请签到：</p>
                    <br />
                    <form class="layui-form" id="checkInForm">
                        <div class="layui-form-item well">
                            <label class="layui-form-label" style="width:100px">班次类型:</label>
                            <div class="layui-inline">
                                <select name="shiftType" id="dropList" lay-verify="required">
                                    <option value="">请选择班次类型</option>
                                    <option value="0">早班</option>
                                    <option value="1">午班</option>
                                    <option value="2">晚班</option>
                                </select>
                            </div>
                            @{
                                // 获取 ViewBag 中的 status 值
                                int? status = ViewBag.status;
                            }
                            @if (status.HasValue && status == 1)
                            {
                                <!-- 如果 status 为 1，显示按钮 -->
                                <button id="checkInBtn" class="layui-btn" style="margin-left: 20px; display:none;" lay-submit lay-filter="checkIn">上班签到</button>
                            }
                            else
                            {
                                <!-- 否则，隐藏按钮 -->
                                <button id="checkInBtn" class="layui-btn" style="margin-left:20px; " lay-submit lay-filter="checkIn">上班签到</button>
                            }
                        </div>
                    </form>
                    <div class="layui-form-item layui-hide" id="resultContainer">
                        <div class="layui-input-block">
                            <span id="resultLabel" class="layui-form-text"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-8">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5 style="font-weight:bold">个人维修任务</h5>
                </div>
                <div class="ibox-content">
                    <div class="layui-card-body">

                        <table id="demo" lay-filter="test"></table>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    layui.use(['table', 'util', "layer","form"], function () {
        var form = layui.form;
        var table = layui.table;
        var util = layui.util;
        var layer = layui.layer;
        // 监听表单提交
        form.on('submit(checkIn)', function (data) {
            var selectedValue = $('#dropList').val();
            // 调用接口插入数据
            $.get('/EmployCheckIn/Insert', { selectedValue: selectedValue }, function (res) {
                if (res.code === 200) {
                    $('#checkInBtn').hide();
                    $('#resultContainer').removeClass('layui-hide');
                    layer.msg(res.msg);
                } else {
                    layer.msg('签到失败：' + res.msg, { icon: 2 });
                }
            });
            return false;
        });
        table.render({
            elem: '#demo'
            , url: '/EmployTasks/Repair'
            , response: {
                statusName: 'code' //规定数据状态的字段名称，默认：code
                , statusCode: 200 //规定成功的状态码，默认：0
                , msgName: 'msg' //规定状态信息的字段名称，默认：msg
                , countName: 'count' //规定数据总数的字段名称，默认：count
                , dataName: 'data' //规定数据列表的字段名称，默认：data
            }
            , cols: [[
                { field: 'name', title: '上报人' }
                , {
                    field: 'location', title: '维修地点'
                }
                , { field: 'confirmer', title: '确认人' }
                , {
                    field: 'start_time', title: '开始时间', templet: function (d) {
                        return util.toDateString(d.start_time.replace("/Date(", "").replace(")/", ""), "yyyy-MM-dd")
                    }
                }
                , {
                    field: 'end_time', title: '结束时间', templet: function (d) {
                        return util.toDateString(d.end_time.replace("/Date(", "").replace(")/", ""), "yyyy-MM-dd")
                    }
                }
                , {
                    field: 'create_time', title: '上报时间'
                    , templet: function (d) {
                        return util.toDateString(d.create_time.replace("/Date(", "").replace(")/", ""), "yyyy-MM-dd")
                    }
                }
            ]]
        });
        table.on('tool(test)', function (obj) {
            var data = obj.data;
            var id = data.id;
            if (obj.event === 'edit') {
                // 显示弹出层
                layer.open({
                    type: 2,
                    title: '详细信息',
                    content: "/EmployTasks/Detail/" + id,
                    area: ['800px', '300px']
                });
            }
        });
    });
</script>

